(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{384:function(t,s,a){"use strict";a.r(s);var e=a(11),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"自定义-eslint-规则-统一团队代码规范"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自定义-eslint-规则-统一团队代码规范"}},[t._v("#")]),t._v(" 自定义 ESLint 规则，统一团队代码规范")]),t._v(" "),s("h2",{attrs:{id:"为什么需要-eslint"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么需要-eslint"}},[t._v("#")]),t._v(" 为什么需要 ESLint")]),t._v(" "),s("p",[t._v("都知道 "),s("code",[t._v("ESLint")]),t._v(" 是代码规范校验工具，并且能帮助我们在开发过程中提前发现问题，所以 "),s("code",[t._v("ESLint")]),t._v(" 已经是项目中不可缺少的一部分。")]),t._v(" "),s("p",[t._v("然而下面这种场景会不会很熟悉呢？")]),t._v(" "),s("p",[t._v("在团队中的新项目为了尽快搭建完成，会不断复制粘贴已有项目的 "),s("code",[t._v("ESLint")]),t._v(" 配置文件，久而久之随着项目的增加以及维护者的不同带来的差异，一个团队中的项目出现了许多不同的代码规范、"),s("code",[t._v("ESLint")]),t._v(" 配置，这不利于项目基础规范的统一以及维护。")]),t._v(" "),s("p",[t._v("根据 "),s("code",[t._v("DRY")]),t._v(" 原则，我们是否能够将配置封装成统一的库来复用？答案是肯定的。目前主流的通用配置 "),s("a",{attrs:{href:"https://github.com/vuejs/eslint-plugin-vue",target:"_blank",rel:"noopener noreferrer"}},[t._v("eslint-plugin-vue"),s("OutboundLink")],1),t._v(" 和\n"),s("a",{attrs:{href:"https://www.npmjs.com/package/eslint-config-standard",target:"_blank",rel:"noopener noreferrer"}},[t._v("eslint-config-standard"),s("OutboundLink")],1),t._v(" 等就是做成了 "),s("code",[t._v("ESLint")]),t._v(" 插件，并且含有自定义规则。")]),t._v(" "),s("p",[t._v("下面将介绍如何编写一个 "),s("code",[t._v("ESLint")]),t._v(" 插件，以及自定义规则。")]),t._v(" "),s("h2",{attrs:{id:"插件基本结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#插件基本结构"}},[t._v("#")]),t._v(" 插件基本结构")]),t._v(" "),s("p",[s("code",[t._v("ESLint")]),t._v(" 的基本配置可以是下面这样的一个 "),s("code",[t._v("js")]),t._v(" 文件，其中的 "),s("code",[t._v("standard")]),t._v(" 就是一个插件、通用配置，可以理解为当前配置继承了 "),s("code",[t._v("standard")]),t._v(" 配置。所以 "),s("code",[t._v("ESLint")]),t._v(" 插件其实也就是一个 "),s("code",[t._v("ESLint")]),t._v(" 的配置对象，可供其它配置继承使用。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'standard'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("rules")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("quotes")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'error'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'double'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"项目生成"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#项目生成"}},[t._v("#")]),t._v(" 项目生成")]),t._v(" "),s("p",[t._v("知道了 "),s("code",[t._v("ESLint")]),t._v(" 插件的基本结构之后，当然可以自己手动创建一个 "),s("code",[t._v("npm package")]),t._v(" 项目开始写插件了，但社区中已经有脚手架 "),s("a",{attrs:{href:"https://www.npmjs.com/package/generator-eslint",target:"_blank",rel:"noopener noreferrer"}},[t._v("generator-eslint"),s("OutboundLink")],1),t._v("，能够通过简单的 "),s("code",[t._v("CLI")]),t._v(" 交互，快速完成插件项目搭建。")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("安装依赖")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-g")]),t._v(" yo\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-g")]),t._v(" generator-eslint\n")])])])]),t._v(" "),s("li",[s("p",[t._v("执行生成命令")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("yo eslint:plugin\n")])])]),s("p",[t._v("根据问题输入相关信息之后，就可以看见项目的基本结构创建完成了。"),s("code",[t._v("lib/index.js")]),t._v(" 就是插件的主入口了， "),s("code",[t._v("rules")]),t._v(" 文件夹里面存放我们的自定义规则。")])])]),t._v(" "),s("h2",{attrs:{id:"继承通用规范"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#继承通用规范"}},[t._v("#")]),t._v(" 继承通用规范")]),t._v(" "),s("p",[t._v("社区中已有许多成熟的规范，所以该插件选择先继承这些通用规范。")]),t._v(" "),s("p",[t._v("这里选择了使用 "),s("a",{attrs:{href:"https://www.npmjs.com/package/eslint-config-standard",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.npmjs.com/package/eslint-config-standard"),s("OutboundLink")],1),t._v(" 和 "),s("a",{attrs:{href:"https://github.com/prettier/eslint-config-prettier",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/prettier/eslint-config-prettier"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("p",[t._v("安装完对应依赖之后，修改 "),s("code",[t._v("lib/index.js")]),t._v("。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'standard'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'prettier'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"目标需求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#目标需求"}},[t._v("#")]),t._v(" 目标需求")]),t._v(" "),s("p",[t._v("每个团队中因为各自的业务需求特性，多少都会需要一些自定义的编码规则来让项目更可控。")]),t._v(" "),s("p",[t._v("比如公司中的项目需要私有化，简单来说就是将应用部署到甲方公司内部，使用甲方自己的域名进行访问，这就要求代码中的域名都要替换成甲方要求的域名，如果一个应用中都是把域名硬编码在代码中，那么私有化开发将变得难以进行，最好是全局引用统一的变量，那么私有化中只要改这个变量即可。")]),t._v(" "),s("p",[t._v("所以这里就有一个需求，我们要自定义一个规则禁止代码中出现硬编码的域名。")]),t._v(" "),s("h2",{attrs:{id:"自定义-rule"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自定义-rule"}},[t._v("#")]),t._v(" 自定义 rule")]),t._v(" "),s("h3",{attrs:{id:"创建-rules-相关文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建-rules-相关文件"}},[t._v("#")]),t._v(" 创建 rules 相关文件")]),t._v(" "),s("p",[t._v("看到 "),s("code",[t._v("rules")]),t._v(" 文件夹里面还是空的，所以执行 "),s("code",[t._v("yo eslint:rule")]),t._v(" 可以快速创建自定义 "),s("code",[t._v("rule")]),t._v(" 的相关文件。执行命令创建了一个 "),s("code",[t._v("id")]),t._v(" 为 "),s("code",[t._v("no-domain")]),t._v(" 的规则，可以看到 "),s("code",[t._v("rules")]),t._v(" 以及 "),s("code",[t._v("tests")]),t._v(" 文件夹中都出现了对应的文件。")]),t._v(" "),s("h3",{attrs:{id:"rules-基本结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rules-基本结构"}},[t._v("#")]),t._v(" rules 基本结构")]),t._v(" "),s("p",[t._v("打开 "),s("code",[t._v("lib/rules/no-domain.js")]),t._v(" 可以看见一个 "),s("code",[t._v("rule")]),t._v(" 是大致如下的一个对象。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("meta")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("docs")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'no-domain'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("create")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("code",[t._v("meta")]),t._v(" 是该规则的基本信息。"),s("code",[t._v("create")]),t._v(" 就是规则的主要逻辑，该函数返回一个都是方法的对象，"),s("code",[t._v("ESLint")]),t._v(" 在执行的时候会遍历 "),s("code",[t._v("AST")]),t._v("，调用该对象里面对应的方法，所以自定义规则就是在这些方法里面“干活”。")]),t._v(" "),s("p",[t._v("更多关于 "),s("code",[t._v("rules")]),t._v(" 的介绍可查看 "),s("a",{attrs:{href:"https://eslint.org/docs/developer-guide/working-with-rules",target:"_blank",rel:"noopener noreferrer"}},[t._v("Working with Rules"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("p",[t._v("因为下方内容会涉及到 "),s("code",[t._v("AST")]),t._v("， 所以请先简单了解什么是 "),s("code",[t._v("AST")]),t._v("，推荐阅读 "),s("RouterLink",{attrs:{to:"/blogs/ast-and-babel.html"}},[t._v("AST 与 Babel")]),t._v("。\n"),s("code",[t._v("ESlint")]),t._v(" 使用了 "),s("a",{attrs:{href:"https://github.com/estree/estree",target:"_blank",rel:"noopener noreferrer"}},[t._v("ESTree"),s("OutboundLink")],1),t._v(" 规范的 "),s("code",[t._v("AST")]),t._v("。")],1),t._v(" "),s("h3",{attrs:{id:"基本思路"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基本思路"}},[t._v("#")]),t._v(" 基本思路")]),t._v(" "),s("p",[t._v("既然了解到了 "),s("code",[t._v("ESlint")]),t._v(" 会解析遍历 "),s("code",[t._v("AST")]),t._v("，那么我们的需求就可以转化为：")]),t._v(" "),s("ol",[s("li",[t._v("访问 "),s("code",[t._v("AST")]),t._v(" 中的字面量。")]),t._v(" "),s("li",[t._v("对字面量进行检测，如果匹配判断到该字面量是域名则抛出错误。")])]),t._v(" "),s("p",[t._v("要访问到字面量，那么就需要知道字面量在 "),s("code",[t._v("AST")]),t._v(" 解析器中的类型，推荐使用 "),s("a",{attrs:{href:"https://astexplorer.net/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://astexplorer.net/"),s("OutboundLink")],1),t._v("，该网站可以选择你想要的 "),s("code",[t._v("AST")]),t._v(" 解析器让代码解析成 "),s("code",[t._v("AST")]),t._v("。")]),t._v(" "),s("p",[t._v("在解析网站中输入 "),s("code",[t._v("'https://test.com'")]),t._v("，可以看到大致如下的解析结果。根据 "),s("code",[t._v("type")]),t._v(" 属性可知，我们将要访问的节点类型就是 "),s("code",[t._v("Literal")]),t._v("。")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Program"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"body"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ExpressionStatement"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"expression"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Literal"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"value"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://test.com"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"raw"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"'https://test.com'\"")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"directive"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://test.com"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"sourceType"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"module"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"测试驱动开发"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试驱动开发"}},[t._v("#")]),t._v(" 测试驱动开发")]),t._v(" "),s("p",[t._v("找到 "),s("code",[t._v("tests")]),t._v(" 文件夹中，发现里面也自动创建了 "),s("code",[t._v("no-domain")]),t._v(" 的测试文件，脚手架默认使用 "),s("code",[t._v("mocha")]),t._v(" 还有 "),s("code",[t._v("ESLint")]),t._v(" 自带的 "),s("a",{attrs:{href:"https://eslint.org/docs/developer-guide/nodejs-api#ruletester",target:"_blank",rel:"noopener noreferrer"}},[t._v("RuleTester"),s("OutboundLink")],1),t._v(" 来进行单元测试。")]),t._v(" "),s("p",[t._v("修改 "),s("code",[t._v("/tests/lib/rules/no-domain.js")]),t._v("。插件的单元测试，简单来说就是由一组能够通过 "),s("code",[t._v("rule")]),t._v(" 校验的 "),s("code",[t._v("case")]),t._v("，如下方的 "),s("code",[t._v("valid")]),t._v("，以及一组会抛出错误的 "),s("code",[t._v("case")]),t._v("，如下方的 "),s("code",[t._v("invalid")]),t._v("，所组成。")]),t._v(" "),s("p",[t._v("执行单元测试 "),s("code",[t._v("npm test")]),t._v("，发现 "),s("code",[t._v("valid")]),t._v(" 的 "),s("code",[t._v("case")]),t._v(" 通过了，而 "),s("code",[t._v("invalid")]),t._v(" 里面的没通过。这是必然的，因为我们的自定义 "),s("code",[t._v("rule")]),t._v(" 还没有写入任何逻辑。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" rule "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../../../lib/rules/no-domain'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" RuleTester "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'eslint'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ruleTester "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RuleTester")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nruleTester"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'no-domain'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" rule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("valid")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'var a = 123'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("invalid")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("code")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("var a = 'https://test.com'")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("errors")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("message")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'不允许在代码中硬编码域名'")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"完善-rule-逻辑"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#完善-rule-逻辑"}},[t._v("#")]),t._v(" 完善 rule 逻辑")]),t._v(" "),s("p",[t._v("修改 "),s("code",[t._v("lib/rules/no-domain.js")]),t._v("，通过上面的介绍我们可知，在"),s("code",[t._v("create")]),t._v(" 返回的对象里面的 "),s("code",[t._v("Literal")]),t._v(" 方法能过访问到 "),s("code",[t._v("AST")]),t._v(" 的字面量，该方法会传入一个 "),s("code",[t._v("node")]),t._v(" 属性，表示当前访问到的 "),s("code",[t._v("AST")]),t._v(" 节点。")]),t._v(" "),s("p",[t._v("通过断点调试（推荐使用 "),s("code",[t._v("VS Code")]),t._v(" 的 "),s("code",[t._v("Debug Terminal")]),t._v("）执行单元测试，可以看到 "),s("code",[t._v("node")]),t._v(" 中有一个属性 "),s("code",[t._v("value")]),t._v("，就是该节点的值，那么可以使用正则对值进行匹配，如果发现是域名，那么就使用 "),s("code",[t._v("ESLint")]),t._v(" 提供的 "),s("a",{attrs:{href:"https://eslint.org/docs/developer-guide/working-with-rules#contextreport",target:"_blank",rel:"noopener noreferrer"}},[t._v("context.report()"),s("OutboundLink")],1),t._v(" 方法来抛出问题，这样一个简单的 "),s("code",[t._v("rule")]),t._v(" 就编写完成了。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("meta")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'problem'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("docs")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'no-domain'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("create")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Literal")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("node")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token regex"}},[s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("https?:\\/\\/\\w+\\.\\w+")]),s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("report")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("message")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'不允许在代码中硬编码域名'")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("再次执行 "),s("code",[t._v("npm test")]),t._v("，通过所有的 "),s("code",[t._v("case")]),t._v("。（注：当前插件只是 "),s("code",[t._v("demo")]),t._v(" 而且，只是用于阐述 "),s("code",[t._v("rule")]),t._v(" 的基本编写，仅供参考。）")]),t._v(" "),s("h2",{attrs:{id:"共享插件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#共享插件"}},[t._v("#")]),t._v(" 共享插件")]),t._v(" "),s("p",[t._v("从官方的 "),s("a",{attrs:{href:"https://cn.eslint.org/docs/developer-guide/working-with-plugins#configs-in-plugins",target:"_blank",rel:"noopener noreferrer"}},[t._v("Configs in Plugins"),s("OutboundLink")],1),t._v(" 中可知，当我们想共享自定义规则的时候可以使用 "),s("code",[t._v("Configs")]),t._v(" 属性，该属性能设定多组不同的基础配置，供第三方使用。")]),t._v(" "),s("p",[t._v("修改 "),s("code",[t._v("package")]),t._v(" 的入口文件 "),s("code",[t._v("lib/index.js")]),t._v("。下方的 "),s("code",[t._v("@xuwenchao0606/base")]),t._v(" 是本人发布的一个插件，"),s("code",[t._v("package")]),t._v(" 的名字为 "),s("code",[t._v("@xuwenchao0606/eslint-plugin-base")]),t._v("，配置中可以缩写为 "),s("code",[t._v("@xuwenchao0606/base")]),t._v("。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("rules")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'no-domain'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./rules/no-domain'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("configs")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("base")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'standard'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'prettier'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("plugins")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@xuwenchao0606/base'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("rules")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'@xuwenchao0606/base/no-domain'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'error'")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("最后，在需要的地方安装、继承该插件、配置即可。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'plugin:@xuwenchao0606/base/base'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("本文相关代码可从 "),s("a",{attrs:{href:"https://github.com/xuwenchao66/mono-packages/tree/master/packages/eslint-plugin-base",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/xuwenchao66/mono-packages/tree/master/packages/eslint-plugin-base"),s("OutboundLink")],1),t._v(" 中查看。")]),t._v(" "),s("h2",{attrs:{id:"参考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),s("ol",[s("li",[s("a",{attrs:{href:"https://cn.eslint.org/docs/developer-guide/shareable-configs",target:"_blank",rel:"noopener noreferrer"}},[t._v("Shareable Configs"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://eslint.org/docs/developer-guide/working-with-rules",target:"_blank",rel:"noopener noreferrer"}},[t._v("Working with Rules"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://eslint.org/docs/developer-guide/working-with-plugins",target:"_blank",rel:"noopener noreferrer"}},[t._v("Working with Plugins"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://eslint.org/docs/developer-guide/nodejs-api#ruletester",target:"_blank",rel:"noopener noreferrer"}},[t._v("RuleTester"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=n.exports}}]);