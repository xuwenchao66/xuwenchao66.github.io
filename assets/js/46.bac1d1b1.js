(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{479:function(t,s,a){"use strict";a.r(s);var n=a(31),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"自定义-eslint-规则-统一团队代码规范"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自定义-eslint-规则-统一团队代码规范"}},[t._v("#")]),t._v(" 自定义 ESLint 规则，统一团队代码规范")]),t._v(" "),a("h2",{attrs:{id:"为什么需要-eslint"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么需要-eslint"}},[t._v("#")]),t._v(" 为什么需要 ESLint")]),t._v(" "),a("p",[t._v("都知道 "),a("code",[t._v("ESLint")]),t._v(" 是代码规范校验工具，并且能帮助我们在开发过程中提前发现问题，所以 "),a("code",[t._v("ESLint")]),t._v(" 已经是项目中不可缺少的一部分。")]),t._v(" "),a("p",[t._v("然而下面这种场景会不会很熟悉呢？")]),t._v(" "),a("p",[t._v("在团队中的新项目为了尽快搭建完成，会不断复制粘贴已有项目的 "),a("code",[t._v("ESLint")]),t._v(" 配置文件，久而久之随着项目的增加以及维护者的不同带来的差异，一个团队中的项目出现了许多不同的代码规范、"),a("code",[t._v("ESLint")]),t._v(" 配置，这不利于项目基础规范的统一以及维护。")]),t._v(" "),a("p",[t._v("根据 "),a("code",[t._v("DRY")]),t._v(" 原则，我们是否能够将配置封装成统一的库来复用？答案是肯定的。目前主流的通用配置 "),a("a",{attrs:{href:"https://github.com/vuejs/eslint-plugin-vue",target:"_blank",rel:"noopener noreferrer"}},[t._v("eslint-plugin-vue"),a("OutboundLink")],1),t._v(" 和\n"),a("a",{attrs:{href:"https://www.npmjs.com/package/eslint-config-standard",target:"_blank",rel:"noopener noreferrer"}},[t._v("eslint-config-standard"),a("OutboundLink")],1),t._v(" 等就是做成了 "),a("code",[t._v("ESLint")]),t._v(" 插件，并且含有自定义规则。")]),t._v(" "),a("p",[t._v("下面将介绍如何编写一个 "),a("code",[t._v("ESLint")]),t._v(" 插件，以及自定义规则。")]),t._v(" "),a("h2",{attrs:{id:"插件基本结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#插件基本结构"}},[t._v("#")]),t._v(" 插件基本结构")]),t._v(" "),a("p",[a("code",[t._v("ESLint")]),t._v(" 的基本配置可以是下面这样的一个 "),a("code",[t._v("js")]),t._v(" 文件，其中的 "),a("code",[t._v("standard")]),t._v(" 就是一个插件、通用配置，可以理解为当前配置继承了 "),a("code",[t._v("standard")]),t._v(" 配置。所以 "),a("code",[t._v("ESLint")]),t._v(" 插件其实也就是一个 "),a("code",[t._v("ESLint")]),t._v(" 的配置对象，可供其它配置继承使用。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'standard'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  rules"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    quotes"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'error'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'double'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"项目生成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#项目生成"}},[t._v("#")]),t._v(" 项目生成")]),t._v(" "),a("p",[t._v("知道了 "),a("code",[t._v("ESLint")]),t._v(" 插件的基本结构之后，当然可以自己手动创建一个 "),a("code",[t._v("npm package")]),t._v(" 项目开始写插件了，但社区中已经有脚手架 "),a("a",{attrs:{href:"https://www.npmjs.com/package/generator-eslint",target:"_blank",rel:"noopener noreferrer"}},[t._v("generator-eslint"),a("OutboundLink")],1),t._v("，能够通过简单的 "),a("code",[t._v("CLI")]),t._v(" 交互，快速完成插件项目搭建。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("安装依赖")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i -g yo\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i -g generator-eslint\n")])])])]),t._v(" "),a("li",[a("p",[t._v("执行生成命令")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("yo eslint:plugin\n")])])]),a("p",[t._v("根据问题输入相关信息之后，就可以看见项目的基本结构创建完成了。"),a("code",[t._v("lib/index.js")]),t._v(" 就是插件的主入口了， "),a("code",[t._v("rules")]),t._v(" 文件夹里面存放我们的自定义规则。")])])]),t._v(" "),a("h2",{attrs:{id:"继承通用规范"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#继承通用规范"}},[t._v("#")]),t._v(" 继承通用规范")]),t._v(" "),a("p",[t._v("社区中已有许多成熟的规范，所以该插件选择先继承这些通用规范。")]),t._v(" "),a("p",[t._v("这里选择了使用 "),a("a",{attrs:{href:"https://www.npmjs.com/package/eslint-config-standard",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.npmjs.com/package/eslint-config-standard"),a("OutboundLink")],1),t._v(" 和 "),a("a",{attrs:{href:"https://github.com/prettier/eslint-config-prettier",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/prettier/eslint-config-prettier"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("p",[t._v("安装完对应依赖之后，修改 "),a("code",[t._v("lib/index.js")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'standard'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'prettier'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"目标需求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目标需求"}},[t._v("#")]),t._v(" 目标需求")]),t._v(" "),a("p",[t._v("每个团队中因为各自的业务需求特性，多少都会需要一些自定义的编码规则来让项目更可控。")]),t._v(" "),a("p",[t._v("比如公司中的项目需要私有化，简单来说就是将应用部署到甲方公司内部，使用甲方自己的域名进行访问，这就要求代码中的域名都要替换成甲方要求的域名，如果一个应用中都是把域名硬编码在代码中，那么私有化开发将变得难以进行，最好是全局引用统一的变量，那么私有化中只要改这个变量即可。")]),t._v(" "),a("p",[t._v("所以这里就有一个需求，我们要自定义一个规则禁止代码中出现硬编码的域名。")]),t._v(" "),a("h2",{attrs:{id:"自定义-rule"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自定义-rule"}},[t._v("#")]),t._v(" 自定义 rule")]),t._v(" "),a("h3",{attrs:{id:"创建-rules-相关文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建-rules-相关文件"}},[t._v("#")]),t._v(" 创建 rules 相关文件")]),t._v(" "),a("p",[t._v("看到 "),a("code",[t._v("rules")]),t._v(" 文件夹里面还是空的，所以执行 "),a("code",[t._v("yo eslint:rule")]),t._v(" 可以快速创建自定义 "),a("code",[t._v("rule")]),t._v(" 的相关文件。执行命令创建了一个 "),a("code",[t._v("id")]),t._v(" 为 "),a("code",[t._v("no-domain")]),t._v(" 的规则，可以看到 "),a("code",[t._v("rules")]),t._v(" 以及 "),a("code",[t._v("tests")]),t._v(" 文件夹中都出现了对应的文件。")]),t._v(" "),a("h3",{attrs:{id:"rules-基本结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rules-基本结构"}},[t._v("#")]),t._v(" rules 基本结构")]),t._v(" "),a("p",[t._v("打开 "),a("code",[t._v("lib/rules/no-domain.js")]),t._v(" 可以看见一个 "),a("code",[t._v("rule")]),t._v(" 是大致如下的一个对象。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  meta"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    docs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      description"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'no-domain'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("create")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("context")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("code",[t._v("meta")]),t._v(" 是该规则的基本信息。"),a("code",[t._v("create")]),t._v(" 就是规则的主要逻辑，该函数返回一个都是方法的对象，"),a("code",[t._v("ESLint")]),t._v(" 在执行的时候会遍历 "),a("code",[t._v("AST")]),t._v("，调用该对象里面对应的方法，所以自定义规则就是在这些方法里面“干活”。")]),t._v(" "),a("p",[t._v("更多关于 "),a("code",[t._v("rules")]),t._v(" 的介绍可查看 "),a("a",{attrs:{href:"https://eslint.org/docs/developer-guide/working-with-rules",target:"_blank",rel:"noopener noreferrer"}},[t._v("Working with Rules"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("p",[t._v("因为下方内容会涉及到 "),a("code",[t._v("AST")]),t._v("， 所以请先简单了解什么是 "),a("code",[t._v("AST")]),t._v("，推荐阅读 "),a("RouterLink",{attrs:{to:"/blogs/ast-and-babel.html"}},[t._v("AST 与 Babel")]),t._v("。\n"),a("code",[t._v("ESlint")]),t._v(" 使用了 "),a("a",{attrs:{href:"https://github.com/estree/estree",target:"_blank",rel:"noopener noreferrer"}},[t._v("ESTree"),a("OutboundLink")],1),t._v(" 规范的 "),a("code",[t._v("AST")]),t._v("。")],1),t._v(" "),a("h3",{attrs:{id:"基本思路"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本思路"}},[t._v("#")]),t._v(" 基本思路")]),t._v(" "),a("p",[t._v("既然了解到了 "),a("code",[t._v("ESlint")]),t._v(" 会解析遍历 "),a("code",[t._v("AST")]),t._v("，那么我们的需求就可以转化为：")]),t._v(" "),a("ol",[a("li",[t._v("访问 "),a("code",[t._v("AST")]),t._v(" 中的字面量。")]),t._v(" "),a("li",[t._v("对字面量进行检测，如果匹配判断到该字面量是域名则抛出错误。")])]),t._v(" "),a("p",[t._v("要访问到字面量，那么就需要知道字面量在 "),a("code",[t._v("AST")]),t._v(" 解析器中的类型，推荐使用 "),a("a",{attrs:{href:"https://astexplorer.net/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://astexplorer.net/"),a("OutboundLink")],1),t._v("，该网站可以选择你想要的 "),a("code",[t._v("AST")]),t._v(" 解析器让代码解析成 "),a("code",[t._v("AST")]),t._v("。")]),t._v(" "),a("p",[t._v("在解析网站中输入 "),a("code",[t._v("'https://test.com'")]),t._v("，可以看到大致如下的解析结果。根据 "),a("code",[t._v("type")]),t._v(" 属性可知，我们将要访问的节点类型就是 "),a("code",[t._v("Literal")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Program"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"body"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ExpressionStatement"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"expression"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Literal"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"value"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://test.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"raw"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"'https://test.com'\"")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"directive"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://test.com"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"sourceType"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"module"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"测试驱动开发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试驱动开发"}},[t._v("#")]),t._v(" 测试驱动开发")]),t._v(" "),a("p",[t._v("找到 "),a("code",[t._v("tests")]),t._v(" 文件夹中，发现里面也自动创建了 "),a("code",[t._v("no-domain")]),t._v(" 的测试文件，脚手架默认使用 "),a("code",[t._v("mocha")]),t._v(" 还有 "),a("code",[t._v("ESLint")]),t._v(" 自带的 "),a("a",{attrs:{href:"https://eslint.org/docs/developer-guide/nodejs-api#ruletester",target:"_blank",rel:"noopener noreferrer"}},[t._v("RuleTester"),a("OutboundLink")],1),t._v(" 来进行单元测试。")]),t._v(" "),a("p",[t._v("修改 "),a("code",[t._v("/tests/lib/rules/no-domain.js")]),t._v("。插件的单元测试，简单来说就是由一组能够通过 "),a("code",[t._v("rule")]),t._v(" 校验的 "),a("code",[t._v("case")]),t._v("，如下方的 "),a("code",[t._v("valid")]),t._v("，以及一组会抛出错误的 "),a("code",[t._v("case")]),t._v("，如下方的 "),a("code",[t._v("invalid")]),t._v("，所组成。")]),t._v(" "),a("p",[t._v("执行单元测试 "),a("code",[t._v("npm test")]),t._v("，发现 "),a("code",[t._v("valid")]),t._v(" 的 "),a("code",[t._v("case")]),t._v(" 通过了，而 "),a("code",[t._v("invalid")]),t._v(" 里面的没通过。这是必然的，因为我们的自定义 "),a("code",[t._v("rule")]),t._v(" 还没有写入任何逻辑。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" rule "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../../../lib/rules/no-domain'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" RuleTester "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'eslint'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ruleTester "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RuleTester")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nruleTester"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'no-domain'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" rule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  valid"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'var a = 123'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  invalid"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      code"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("var a = 'https://test.com'")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      errors"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          message"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'不允许在代码中硬编码域名'")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h3",{attrs:{id:"完善-rule-逻辑"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#完善-rule-逻辑"}},[t._v("#")]),t._v(" 完善 rule 逻辑")]),t._v(" "),a("p",[t._v("修改 "),a("code",[t._v("lib/rules/no-domain.js")]),t._v("，通过上面的介绍我们可知，在"),a("code",[t._v("create")]),t._v(" 返回的对象里面的 "),a("code",[t._v("Literal")]),t._v(" 方法能过访问到 "),a("code",[t._v("AST")]),t._v(" 的字面量，该方法会传入一个 "),a("code",[t._v("node")]),t._v(" 属性，表示当前访问到的 "),a("code",[t._v("AST")]),t._v(" 节点。")]),t._v(" "),a("p",[t._v("通过断点调试（推荐使用 "),a("code",[t._v("VS Code")]),t._v(" 的 "),a("code",[t._v("Debug Terminal")]),t._v("）执行单元测试，可以看到 "),a("code",[t._v("node")]),t._v(" 中有一个属性 "),a("code",[t._v("value")]),t._v("，就是该节点的值，那么可以使用正则对值进行匹配，如果发现是域名，那么就使用 "),a("code",[t._v("ESLint")]),t._v(" 提供的 "),a("a",{attrs:{href:"https://eslint.org/docs/developer-guide/working-with-rules#contextreport",target:"_blank",rel:"noopener noreferrer"}},[t._v("context.report()"),a("OutboundLink")],1),t._v(" 方法来抛出问题，这样一个简单的 "),a("code",[t._v("rule")]),t._v(" 就编写完成了。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  meta"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'problem'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    docs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      description"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'no-domain'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("create")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("context")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Literal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("node")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("https?:\\/\\/\\w+\\.\\w+")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("report")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            message"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'不允许在代码中硬编码域名'")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("再次执行 "),a("code",[t._v("npm test")]),t._v("，通过所有的 "),a("code",[t._v("case")]),t._v("。（注：当前插件只是 "),a("code",[t._v("demo")]),t._v(" 而且，只是用于阐述 "),a("code",[t._v("rule")]),t._v(" 的基本编写，仅供参考。）")]),t._v(" "),a("h2",{attrs:{id:"共享插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#共享插件"}},[t._v("#")]),t._v(" 共享插件")]),t._v(" "),a("p",[t._v("从官方的 "),a("a",{attrs:{href:"https://cn.eslint.org/docs/developer-guide/working-with-plugins#configs-in-plugins",target:"_blank",rel:"noopener noreferrer"}},[t._v("Configs in Plugins"),a("OutboundLink")],1),t._v(" 中可知，当我们想共享自定义规则的时候可以使用 "),a("code",[t._v("Configs")]),t._v(" 属性，该属性能设定多组不同的基础配置，供第三方使用。")]),t._v(" "),a("p",[t._v("修改 "),a("code",[t._v("package")]),t._v(" 的入口文件 "),a("code",[t._v("lib/index.js")]),t._v("。下方的 "),a("code",[t._v("@xuwenchao0606/base")]),t._v(" 是本人发布的一个插件，"),a("code",[t._v("package")]),t._v(" 的名字为 "),a("code",[t._v("@xuwenchao0606/eslint-plugin-base")]),t._v("，配置中可以缩写为 "),a("code",[t._v("@xuwenchao0606/base")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  rules"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'no-domain'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./rules/no-domain'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  configs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    base"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'standard'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'prettier'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      plugins"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@xuwenchao0606/base'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      rules"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@xuwenchao0606/base/no-domain'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'error'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("最后，在需要的地方安装、继承该插件、配置即可。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'plugin:@xuwenchao0606/base/base'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("本文相关代码可从 "),a("a",{attrs:{href:"https://github.com/xuwenchao66/mono-packages/tree/master/packages/eslint-plugin-base",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/xuwenchao66/mono-packages/tree/master/packages/eslint-plugin-base"),a("OutboundLink")],1),t._v(" 中查看。")]),t._v(" "),a("h2",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),a("ol",[a("li",[a("a",{attrs:{href:"https://cn.eslint.org/docs/developer-guide/shareable-configs",target:"_blank",rel:"noopener noreferrer"}},[t._v("Shareable Configs"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://eslint.org/docs/developer-guide/working-with-rules",target:"_blank",rel:"noopener noreferrer"}},[t._v("Working with Rules"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://eslint.org/docs/developer-guide/working-with-plugins",target:"_blank",rel:"noopener noreferrer"}},[t._v("Working with Plugins"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://eslint.org/docs/developer-guide/nodejs-api#ruletester",target:"_blank",rel:"noopener noreferrer"}},[t._v("RuleTester"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);