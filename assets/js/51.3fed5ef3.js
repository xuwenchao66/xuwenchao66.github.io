(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{291:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"rollup-基础实践"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rollup-基础实践","aria-hidden":"true"}},[t._v("#")]),t._v(" rollup 基础实践")]),t._v(" "),a("p",[t._v("本文中的示例代码可以在 "),a("a",{attrs:{href:"https://github.com/xuwenchao66/rollup-practice",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/xuwenchao66/rollup-practice"),a("OutboundLink")],1),t._v(" 中查阅。")]),t._v(" "),a("h2",{attrs:{id:"开始使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开始使用","aria-hidden":"true"}},[t._v("#")]),t._v(" 开始使用")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("全局安装 "),a("code",[t._v("rollup")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" --global rollup\n")])])])]),t._v(" "),a("li",[a("p",[t._v("新建测试工程。")]),t._v(" "),a("p",[t._v("新建一个文件夹，用于测试。新建需要编译的文件 "),a("code",[t._v("index.js")]),t._v(" 内容如下。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("log")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello rollup'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("通过全局 "),a("code",[t._v("CLI")]),t._v(" 执行构建。")]),t._v(" "),a("p",[t._v("执行下方命令，开始构建。")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("rollup index.js --file dist/bundle.js --format es\n")])])]),a("p",[t._v("执行成功后可以发现，出现了一个 "),a("code",[t._v("dist")]),t._v(" 文件夹，里面有一个 "),a("code",[t._v("bundle.js")]),t._v("，就是构建输出的文件。")]),t._v(" "),a("p",[t._v("命令简析：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("rollup index.js")]),t._v("： 使用 "),a("code",[t._v("rollup")]),t._v(" 对 "),a("code",[t._v("index.js")]),t._v(" 进行编译。")]),t._v(" "),a("li",[a("code",[t._v("--file dist/bundle.js")]),t._v("： 输出路径为 "),a("code",[t._v("dist/bundle.js")]),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("--format es")]),t._v("：输出格式为 "),a("code",[t._v("ES")]),t._v(" 模块。")])])])]),t._v(" "),a("h2",{attrs:{id:"使用配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用配置文件","aria-hidden":"true"}},[t._v("#")]),t._v(" 使用配置文件")]),t._v(" "),a("p",[t._v("使用 "),a("code",[t._v("CLI")]),t._v(" 能快速上手，但是落实到实践的时候，使用可读性以及可维护性更好的配置文件是更合适的选择。")]),t._v(" "),a("p",[t._v("通常配置文件是一个名为 "),a("code",[t._v("rollup.config.js")]),t._v(" 的文件，该文件在项目根目录。配置文件导出一个对象。")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("新增 "),a("code",[t._v("rollup.config.js")]),t._v("，其内容如下。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  input"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'index.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  output"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist/bundle.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    format"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'es'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("指定配置文件，执行构建。")]),t._v(" "),a("p",[t._v("执行下方命令，成功构建。"),a("code",[t._v("--config")]),t._v(" 用于指定配置文件，也可用缩写 "),a("code",[t._v("-c")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("rollup --config rollup.config.js\n")])])])])]),t._v(" "),a("h2",{attrs:{id:"常用配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用配置","aria-hidden":"true"}},[t._v("#")]),t._v(" 常用配置")]),t._v(" "),a("h3",{attrs:{id:"常用配置项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用配置项","aria-hidden":"true"}},[t._v("#")]),t._v(" 常用配置项")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("input")])]),t._v(" "),a("p",[t._v("构建入口描述，常用的是使用一个字符串来描述入口文件的所在位置。"),a("code",[t._v("input")]),t._v(" 也可以是一个数组、对象，更多详细用法可查看 "),a("a",{attrs:{href:"http://rollupjs.org/guide/en/#input",target:"_blank",rel:"noopener noreferrer"}},[t._v("rollupjs#input"),a("OutboundLink")],1),t._v("。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("output")])]),t._v(" "),a("p",[t._v("构建输出描述，通常一个对象，"),a("code",[t._v("output")]),t._v(" 常用的属性有：")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("output.file")]),t._v(" 指定输出文件。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("output.format")]),t._v(" 指定输出的格式。可以是 "),a("code",[t._v("es")]),t._v("、"),a("code",[t._v("cjs")]),t._v("、"),a("code",[t._v("umd")]),t._v(" 等常见的模块格式。")])])]),t._v(" "),a("p",[t._v("更多详细用法可查看 "),a("a",{attrs:{href:"http://rollupjs.org/guide/en/#outputdir",target:"_blank",rel:"noopener noreferrer"}},[t._v("rollupjs#output"),a("OutboundLink")],1),t._v("。")])])]),t._v(" "),a("h3",{attrs:{id:"常用配置方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用配置方案","aria-hidden":"true"}},[t._v("#")]),t._v(" 常用配置方案")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("单入口、单出口。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  input"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'index.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  output"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist/bundle.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    format"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'es'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("单入口、多出口。")]),t._v(" "),a("p",[t._v("某些场景，我们的库可能需要同时提供给 "),a("code",[t._v("browser")]),t._v("、"),a("code",[t._v("server")]),t._v(" 端使用。")]),t._v(" "),a("p",[t._v("所以需要同时输出 "),a("code",[t._v("es")]),t._v("、"),a("code",[t._v("commonjs")]),t._v(" 规范的模块，这时候可以把 "),a("code",[t._v("input")]),t._v(" 声明为一个数组，这样一个入口能输出不同规范的模块。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  input"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'index.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  output"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist/bundle.es.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      format"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'es'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist/bundle.cjs.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      format"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cjs'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("多入口、多出口。")]),t._v(" "),a("p",[t._v("一个库可能有多个不同的入口文件，这时候可以使用数组来声明配置对象。我们新增一个 "),a("code",[t._v("main.js")]),t._v(" 入口文件，然后使用如下配置就能够实现多入口、出口的构建。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    input"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'index.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    output"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist/index.es.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        format"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'es'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist/index.cjs.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        format"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cjs'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    input"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'main.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    output"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist/main.es.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        format"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'es'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist/main.cjs.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        format"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cjs'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])])])]),t._v(" "),a("h2",{attrs:{id:"常用插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用插件","aria-hidden":"true"}},[t._v("#")]),t._v(" 常用插件")]),t._v(" "),a("p",[t._v("在实践中我们往往会引用外部的 "),a("code",[t._v("npm package")]),t._v("，比如 "),a("code",[t._v("lodash")]),t._v("。同时为了兼容较低版本的浏览器，也需要将代码编译成 "),a("code",[t._v("ES5")]),t._v("。")]),t._v(" "),a("p",[t._v("在项目中安装 "),a("code",[t._v("lodash")]),t._v("，"),a("code",[t._v("npm i lodash")]),t._v("。")]),t._v(" "),a("p",[t._v("在 "),a("code",[t._v("index.js")]),t._v(" 中引入使用 "),a("code",[t._v("lodash")]),t._v("，修改文件为。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" cloneDeep "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'lodash/cloneDeep'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("log")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello rollup'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cloneDeep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("执行构建，可以发现，控制台中出现了警告，而且编译出来的代码，箭头函数还存在，没有编译为 "),a("code",[t._v("ES5")]),t._v(" 版本的代码。")]),t._v(" "),a("p",[t._v("这是因为 "),a("code",[t._v("rollup")]),t._v(" 本身只包含了其核心功能，也就是对代码文件的读取、解析、转换，其它功能以"),a("strong",[t._v("插件")]),t._v("的形式来实现。这样同时保证了 "),a("code",[t._v("rollup")]),t._v(" 的扩展性、可维护性。")]),t._v(" "),a("h3",{attrs:{id:"rollup-plugin-node-resolve"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rollup-plugin-node-resolve","aria-hidden":"true"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://github.com/rollup/plugins/tree/master/packages/node-resolve",target:"_blank",rel:"noopener noreferrer"}},[t._v("@rollup/plugin-node-resolve"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("通过控制台可以看到如下警告。")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" Unresolved dependencies\nhttps://rollupjs.org/guide/en/"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#warning-treating-module-as-external-dependency")]),t._v("\n")])])]),a("p",[t._v("这是因为 "),a("code",[t._v("rollup")]),t._v(" 默认只会解析相对路径的模块，如 "),a("code",[t._v("import main from './main.js'")]),t._v("。")]),t._v(" "),a("p",[t._v("当使用如 "),a("code",[t._v("import cloneDeep from 'lodash/cloneDeep'")]),t._v(" 时，"),a("code",[t._v("rollup")]),t._v(" 是不知道该如何找到该模块的，所以把此模块认为是 "),a("code",[t._v("external")]),t._v("（外置依赖）。")]),t._v(" "),a("p",[t._v("为了让 "),a("code",[t._v("rollup")]),t._v(" 能够使用 "),a("a",{attrs:{href:"https://nodejs.org/api/modules.html#modules_all_together",target:"_blank",rel:"noopener noreferrer"}},[t._v("nodejs 的模块解析方案"),a("OutboundLink")],1),t._v("，需要使用 "),a("a",{attrs:{href:"https://github.com/rollup/plugins/tree/master/packages/node-resolve",target:"_blank",rel:"noopener noreferrer"}},[t._v("node-resolve"),a("OutboundLink")],1),t._v(" 插件。")]),t._v(" "),a("p",[t._v("安装依赖 "),a("code",[t._v("npm install @rollup/plugin-node-resolve --save-dev")]),t._v("。")]),t._v(" "),a("p",[t._v("在配置中使用插件。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" nodeResolve "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@rollup/plugin-node-resolve'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  plugins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("nodeResolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("这时候在此执行构建，会发现原有的警告消失了，说明 "),a("code",[t._v("rollup")]),t._v(" 已经成功找到了模块。但是出现了另外一个报错。")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Error: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'default'")]),t._v(" is not exported by "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/node_modules/lodash/cloneDeep.js, imported by index.js\nhttps://rollupjs.org/guide/en/"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#error-name-is-not-exported-by-module")]),t._v("\n")])])]),a("p",[t._v("这是因为 "),a("code",[t._v("rollup")]),t._v(" 使用的是 "),a("code",[t._v("ES")]),t._v(" 模块机制，无法解析 "),a("code",[t._v("commonjs")]),t._v(" 的模块，所以如果需要引入 "),a("code",[t._v("commonjs")]),t._v(" 模块，需要使用 "),a("code",[t._v("@rollup/plugin-commonjs")]),t._v(" 插件。")]),t._v(" "),a("h3",{attrs:{id:"rollup-plugin-commonjs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rollup-plugin-commonjs","aria-hidden":"true"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://github.com/rollup/plugins/tree/master/packages/commonjs",target:"_blank",rel:"noopener noreferrer"}},[t._v("@rollup/plugin-commonjs"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("能够将 "),a("code",[t._v("commonjs")]),t._v(" 模块转换成 "),a("code",[t._v("ES")]),t._v(" 模块，这样 "),a("code",[t._v("rollup")]),t._v(" 就能解析 "),a("code",[t._v("commonjs")]),t._v(" 模块了。")]),t._v(" "),a("p",[t._v("安装依赖 "),a("code",[t._v("npm install @rollup/plugin-commonjs --save-dev")]),t._v("。")]),t._v(" "),a("p",[t._v("修改配置文件。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" nodeResolve "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@rollup/plugin-node-resolve'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" commonjs "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@rollup/plugin-commonjs'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  plugins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("nodeResolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("commonjs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("再次构建，这次代码 "),a("code",[t._v("import")]),t._v(" "),a("code",[t._v("lodash")]),t._v(" 进来了，构建成功。")]),t._v(" "),a("h3",{attrs:{id:"rollup-plugin-babel"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rollup-plugin-babel","aria-hidden":"true"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://github.com/rollup/plugins/tree/master/packages/babel",target:"_blank",rel:"noopener noreferrer"}},[t._v("@rollup/plugin-babel"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("根据上面的了解，可知语法转译也需要安装插件来处理。")]),t._v(" "),a("p",[t._v("安装依赖 "),a("code",[t._v("npm install @rollup/plugin-babel @babel/core --save-dev")]),t._v("。")]),t._v(" "),a("p",[t._v("修改配置文件。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" nodeResolve "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@rollup/plugin-node-resolve'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" commonjs "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@rollup/plugin-commonjs'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" babel "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@rollup/plugin-babel'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  plugins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("nodeResolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("commonjs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("babel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("再次执行构建可以发现 "),a("code",[t._v("ES6")]),t._v(" 的箭头函数、"),a("code",[t._v("const")]),t._v(" 等语法糖都转译成 "),a("code",[t._v("ES5")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"更多常用插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更多常用插件","aria-hidden":"true"}},[t._v("#")]),t._v(" 更多常用插件")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/rollup/plugins/tree/master/packages/eslint",target:"_blank",rel:"noopener noreferrer"}},[t._v("@rollup/plugin-eslint"),a("OutboundLink")],1),t._v("，"),a("code",[t._v("ESLint")]),t._v(" 插件。")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/rollup/plugins/tree/master/packages/alias",target:"_blank",rel:"noopener noreferrer"}},[t._v("@rollup/plugin-alias"),a("OutboundLink")],1),t._v("，类似 "),a("code",[t._v("Webpack")]),t._v(" 的 "),a("code",[t._v("alias")]),t._v(" 配置，为模块设置别名。")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/TrySound/rollup-plugin-terser",target:"_blank",rel:"noopener noreferrer"}},[t._v("rollup-plugin-terser"),a("OutboundLink")],1),t._v("，代码压缩。")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/ritz078/rollup-plugin-filesize",target:"_blank",rel:"noopener noreferrer"}},[t._v("rollup-plugin-filesize"),a("OutboundLink")],1),t._v("，展示构建输出的文件体积。")])]),t._v(" "),a("h2",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考","aria-hidden":"true"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),a("ol",[a("li",[a("a",{attrs:{href:"http://rollupjs.org/guide/en/",target:"_blank",rel:"noopener noreferrer"}},[t._v("rollupjs"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"http://rollupjs.org/guide/en/#faqs",target:"_blank",rel:"noopener noreferrer"}},[t._v("rollupjs#faqs"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"http://rollupjs.org/guide/en/#how-do-i-use-rollup-in-nodejs-with-commonjs-modules",target:"_blank",rel:"noopener noreferrer"}},[t._v("rollupjs#how-do-i-use-rollup-in-nodejs-with-commonjs-modules"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"http://rollupjs.org/guide/en/#troubleshooting",target:"_blank",rel:"noopener noreferrer"}},[t._v("rollupjs#troubleshooting"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);